# 테스트하기 좋은 코드 - 2. 제어할 수 없는 코드 개선

### 문제 상황

- 테스트하기 어려운 코드가 도메인 로직이 되었을 때
    - 해당 코드에 의존하는 모든 코드들이 테스트하기 어려워 지는 공경에 처한다..!
- 결론적으로 테스트하기 어려운 코드와 쉬운 코드로 분리를 시키는 것이 중요하다.

### 해결

- 생성자, 함수의 인자로 테스트하기 어려운 코드의 결과를 받는 것
    - 외부에서 주입 받자.
- 함수 인자의 기본값으로 선언하기
    - 매개변수를 사용할 필요가 없는 함수가 된다..!
    - 그리고 테스트 시에는 내가 원하는 인자를 사용하면 된다..!

### 기본값 지원이 안된다면?

- 의존하는 코드가 가장 적은 영역까지 밀어내기
    - Controller / Event Handler 까지 밀어내기
- 프로그램의 진입점이 되는 영역에 테스트하기 어려운 코드를 모아두고, 그 다음 계층부터 테스트해 나가기
    - 제어할 수 없는 코드를 바깥으로 밀어내어 의존 범위를 좁힌다.

### 의존성 주입

- 위의 방법은 여전히 바깥 계층의 테스트가 어렵고, 제어할 수 없는 값을 인자로 받아야한다.
- 제어할 수 없는 값을 반환하는 인터페이스를 두고, 테스트와 메인 코드에 이용한다.